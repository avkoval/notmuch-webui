{% extends "templates/base.html" %}

{% block extra-head %}
  <style>
   .loading {
     text-decoration:line-through;
     color: red;
   }
   .subjects {
     margin-bottom: 1px !important;
   }
  </style>
{% endblock %}

{% block body %}
  <h2 class="title is-2">{{ subject }}</h2>
  {% for message in messages %}
    {% with content=message|first message_number=forloop.counter0 %}
      <section class="section">
        <div class="container">
          <table class="table is-fullwidth" 
                 data-signals-hide-message-{{ forloop.counter0 }}="true" 
                 data-on-click="$hideMessage{{ forloop.counter0 }}=!$hideMessage{{ forloop.counter0 }}">
            <thead>
              <tr class="is-info">
                <th><i class="fa-regular fa-star"></i></th>
                <th>Date</th>
                <th>Correspondents</th>
                <th>Subject</th>
                <th><i class="fa-regular fa-envelope"></i></th>
                <th>Tags</th>
              </tr>
            </thead>
            <tr>
              <td>{% for tag in content.tags %}{% ifequal "important" tag %}<i class="fa-regular fa-star"></i>{% endifequal %}{% endfor %}</td>
              <td>{{ content.date_relative }}</td>
              <td>{{ content.headers.From }}</td>
              <td>{{ content.headers.Subject }}</td>
              <td>{% for tag in content.tags %}{% ifequal "unread" tag %}<i class="fa-solid fa-envelope"></i>{% endifequal %}{% endfor %}</td>
              <td>
                {% for tag in content.tags  %}
                  {{ tag }}
                {% endfor %}
              </td>
            </tr>
          </table>
        </div>
        <div class="container is-hidden" data-class-is-hidden="$hideMessage{{ forloop.counter0 }}">
          {% with parts=content.body %}
            {% for part in parts %}
              <div data-signals-hide-message{{ message_number }}-level0-part{{ part.id }}="false">
                <h4 class="is-3 title">{{ part.id }}<span class="tag is-light">{{ part.content-type }}</span>
                  <button class="button is-small is-primary"
                          data-on-click="$hideMessage{{ message_number }}Level0Part{{ part.id }}=!$hideMessage{{ message_number }}Level0Part{{ part.id }}"
                  >
                    <span data-class-is-hidden="$hideMessage{{ message_number }}Level0Part{{ part.id }}==false">+</span>
                    <span data-class-is-hidden="$hideMessage{{ message_number }}Level0Part{{ part.id }}==true">-</span>
                  </button></h4>
                <div data-class-is-hidden="$hideMessage{{ message_number }}Level0Part{{ part.id }}">
                  {#  <pre>{% pprint part %}</pre> #}
                  {% with inner=part.content %}
                    {% if part.content-type = "multipart/related" %}
                      {% include "templates/show_render_related.html" %}
                    {% elif part.content-type = "multipart/alternative" %}
                      {% include "templates/show_render_alternative.html" %}
                    {% elif part.content-type = "multipart/mixed" %}
                      {% include "templates/show_render_mixed.html" %}
                    {% endif %}
                  {% endwith %}
                </div>
              </div>
            {% endfor %}
          {% endwith %}
        </div>
      </section>
    {% endwith %}
  {% endfor %}
{% endblock %}
